Pohnout se slovenským treebankem! Márii Šimkové jsem slíbil, že vytáhnu věty, kde se obě anotátorky shodly, a pošlu jí je. Ona sice nemá lingvisty, kteří by se tím mohli zabývat, ale pokud bude mít v ruce tohle, je tady určitá nenulová šance, že nakonec schválí, aby se část toho vydala. (Pak bude samozřejmě taky otázka licence. Ideální by bylo, kdyby vyšla Wikipedie a pohádky, které zřejmě nebudou závislé na autorských právech k textům.)

1. Vybrat dokumenty, které byly anotovány dvěma anotátory. Leží ve složce anotator1 nebo anotator2, např.:
   /net/work/people/zeman/slovallex/Wikipedia/anotator1/apollo001_tencerova_dok.a
   /net/work/people/zeman/slovallex/Wikipedia/anotator2/apollo001_kandracova_dok.a
   Dále vynechat dokumenty, které neobsahují ručně anotovanou morfologii.
   Ostatní dokumenty nás vůbec nezajímají.

2. Některé soubory obsahují chyby, kvůli kterým není možné je načíst do Treexu. Např. prázdný uzel s nedefinovaným id a ord na konci souboru /net/work/people/zeman/slovallex/BallekPomocnik/anotator1/H-Pomocnik-082_katarinag_dok.a:
  <LM id="">
   <ord></ord>
  </LM>
  Těchto chyb se musíme zbavit nezávisle na Treexu.
  Jestliže prvek <LM> nemá id, budeme předpokládat, že je prázdný a že ho vůbec nechceme.
  filter_stb_and_fix_pml.pl (volá fix_pml.pl)

3. Některé soubory obsahují duplikáty uzlů, a to včetně nezměněného id. Takové soubory sice Treex dokáže přečíst, ale
   je potřeba co nejdříve duplicitní uzly vyhledat a odstranit, aby Treex přestal řvát a aby následující operace
   nepracovaly s vadnými daty. Viz blok A2A::RemoveDuplicateNodes níže.

4. Také máme v některých místech vadné reference z vyšších rovin na nižší:
   doc0002774_job002: warning: KNIT failed: ID m-vojna007-p6s3w37 not found in reffile 'm'
   To se pravděpodobně vyřeší prostě tak, že budou prázdná některá pole (včetně slovního tvaru), na základě čehož nakonec dotyčný soubor vyhodíme.

5. Zkonvertovat soubory z formátu PDT PML do formátu CoNLL (2006, nebo 2009?)

SCHEMA_DIR=/net/work/people/zeman/treex/lib/Treex/Block/Read/PDT_schema
STB_DIR=/net/work/people/zeman/stb_fixed
treex -p -j100 -Lsk Read::PDT schema_dir=$SCHEMA_DIR from='!'$STB_DIR/*/anotator*/*.a top_layer=a A2A::RemoveDuplicateNodes Util::Eval atree='$._normalize_node_ordering()' Util::Eval anode='if($.afun() eq "???") {$.set_afun("NR")}' Write::CoNLLX is_member_within_afun=1 substitute={stb_fixed}{stb-conll}

###!!!
Potřebovali bychom zachovat také atribut is_parenthesis_root, ale ten se momentálně zřejmě ignoruje.
Také ztrácím původní id uzlů. I když je v nich místy binec, je to škoda, protože obsahují čísla původních slov, vět a dokonce odstavců.
###!!!

zeman@lrc2:/net/work/people/zeman/hamledt/normalize/sk$ cat /net/work/people/zeman/stb-conll/*/anotator1/*.conll | wc_conll.pl
41819 sentences, 690994 tokens
zeman@lrc2:/net/work/people/zeman/hamledt/normalize/sk$ cat /net/work/people/zeman/stb-conll/*/anotator2/*.conll | wc_conll.pl
41824 sentences, 691109 tokens

6. Načíst páry souborů do Treexu vedle sebe (vždy anotátor 1 v jedné zóně a anotátor 2 ve druhé).

###!!! Otestovat, jak se to vlastně volá. Dokumentace ve zdrojáku téměř chybí. Viz též Github issue:
###!!! https://github.com/ufal/treex/issues/54
treex Read::AlignedCoNLL conll_format=2006 is_member_within_afun=1 sk_annotator1='!/net/work/people/zeman/stb-conll/*/anotator1/*.conll' sk_annotator2='!/net/work/people/zeman/stb-conll/*/anotator2/*.conll' Write::Treex substitute={stb-conll}{stb-merged}
